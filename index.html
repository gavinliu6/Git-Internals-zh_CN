<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.20">
<meta name="author" content="Harsh Kapadia">
<link rel="icon" type="image/x-icon" href="./static/img/favicon.ico">
<title>Git 内部结构</title>
<style>
/*! Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment the following line when using as a custom stylesheet */
/* @import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700"; */
html{font-family:sans-serif;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
b,strong{font-weight:bold}
abbr{font-size:.9em}
abbr[title]{cursor:help;border-bottom:1px dotted #dddddf;text-decoration:none}
dfn{font-style:italic}
hr{height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type=checkbox],input[type=radio]{padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,::before,::after{box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;line-height:1;position:relative;cursor:auto;-moz-tab-size:4;-o-tab-size:4;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ul.square{list-style-type:square}
ul.circle ul:not([class]),ul.disc ul:not([class]),ul.square ul:not([class]){list-style:inherit}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:1px solid #dedede;word-wrap:normal}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre).nobreak{word-wrap:normal}
:not(pre).nowrap{white-space:nowrap}
:not(pre).pre-wrap{white-space:pre-wrap}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;border-radius:3px;box-shadow:0 1px 0 rgba(0,0,0,.2),inset 0 0 0 .1em #fff;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin:0 auto;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:flex;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border:1px solid #e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:none;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:hsla(0,0%,100%,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details{margin-left:1.25rem}
details>summary{cursor:pointer;display:block;position:relative;line-height:1.6;margin-bottom:.625rem;outline:none;-webkit-tap-highlight-color:transparent}
details>summary::-webkit-details-marker{display:none}
details>summary::before{content:"";border:solid transparent;border-left:solid;border-width:.3em 0 .3em .5em;position:absolute;top:.5em;left:-1.25rem;transform:translateX(15%)}
details[open]>summary::before{border:solid transparent;border-top:solid;border-width:.5em .3em 0;transform:translateY(15%)}
details>summary::after{content:"";width:1.25rem;height:1em;position:absolute;top:.3em;left:-1.25rem}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class=paragraph]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6);word-wrap:anywhere}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border:1px solid #e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;border-radius:4px}
.sidebarblock{border:1px solid #dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;border-radius:4px}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:first-child,.sidebarblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child,.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{border-radius:4px;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class=highlight],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos,pre.pygments .linenos{border-right:1px solid;opacity:.35;padding-right:.5em;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}
pre.pygments span.linenos{display:inline-block;margin-right:.75em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans-serif;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;font-size:.85rem;text-align:left;margin-right:0}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:1.25em;word-wrap:anywhere}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>*>tr>*{border-width:1px}
table.grid-cols>*>tr>*{border-width:0 1px}
table.grid-rows>*>tr>*{border-width:1px 0}
table.frame-all{border-width:1px}
table.frame-ends{border-width:1px 0}
table.frame-sides{border-width:0 1px}
table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}
table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}
table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}
table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}
table.stripes-all>*>tr,table.stripes-odd>*>tr:nth-of-type(odd),table.stripes-even>*>tr:nth-of-type(even),table.stripes-hover>*>tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
li>p:empty:only-child::before{content:"";display:inline-block}
ul.checklist>li>p:first-child{margin-left:-1em}
ul.checklist>li>p:first-child>.fa-square-o:first-child,ul.checklist>li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist>li>p:first-child>input[type=checkbox]:first-child{margin-right:.25em}
ul.inline{display:flex;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
td.hdlist2{word-wrap:anywhere}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:4px solid #fff;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt,summary{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,td.hdlist1,span.alt,summary{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]{border-bottom:1px dotted}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#header,#content,#footnotes,#footer{max-width:none}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media amzn-kf8,print{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<link rel="stylesheet" href="./static/highlight/styles/github-light-dark.min.css">
<meta
	name="keywords"
	content="asciidoctor, template, pitch black, jet black, black, adoc, dark mode"
/>
<meta name="description" content="A jet black Asciidoctor template." />
<meta name="theme-color" content="#000000" />
<meta property="og:site_name" content="Asciidoctor Jet" />
<meta property="og:title" content="Asciidoctor Jet" />
<meta property="og:type" content="website" />
<meta property="og:description" content="A jet black Asciidoctor template." />
<meta
	property="og:url"
	content="https://harshkapadia2.github.io/asciidoctor-jet"
/>
<meta
	property="og:image"
	content="https://harshkapadia2.github.io/asciidoctor-jet/static/img/icon-512.png"
/>
<meta property="og:image:width" content="512" />
<meta property="og:image:height" content="512" />
<meta
	property="twitter:image"
	content="https://harshkapadia2.github.io/asciidoctor-jet/static/img/icon-512.png"
/>

<script defer src="static/js/script.js"></script>

<link rel="preconnect" href="https://fonts.googleapis.com" />
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
<link
	href="https://fonts.googleapis.com/css2?family=PT+Mono&family=Montserrat&display=swap"
	rel="stylesheet"
/>

<link rel="stylesheet" href="static/css/style.css" />

<link rel="apple-touch-icon" href="static/img/icon-192.png" />

<link rel="manifest" href="manifest.webmanifest" />
</head>
<body class="article toc2 toc-left">
<div id="header">
<h1>Git 内部结构</h1>
<div class="details">
<span id="author" class="author">Harsh Kapadia</span><br>
<span id="revnumber">version 1</span>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_关于">关于</a></li>
<li><a href="#_前置准备">前置准备</a></li>
<li><a href="#_git_目录"><code>.git</code> 目录</a>
<ul class="sectlevel2">
<li><a href="#_简介">简介</a></li>
<li><a href="#_git_目录的内容"><code>.git</code> 目录的内容</a></li>
<li><a href="#_index_文件"><code>index</code> 文件</a></li>
<li><a href="#_head_文件"><code>HEAD</code> 文件</a></li>
<li><a href="#_refs_目录"><code>refs</code> 目录</a></li>
<li><a href="#_packed_refs_文件"><code>packed-refs</code> 文件</a></li>
<li><a href="#_logs_文件夹"><code>logs</code> 文件夹</a></li>
<li><a href="#_fetch_head_文件"><code>FETCH_HEAD</code> 文件</a></li>
<li><a href="#_commit_editmsg_文件"><code>COMMIT_EDITMSG</code> 文件</a></li>
<li><a href="#_objects_目录"><code>objects</code> 目录</a></li>
<li><a href="#_info_目录"><code>info</code> 目录</a></li>
<li><a href="#_config_文件"><code>config</code> 文件</a></li>
<li><a href="#_addp_hunk_edit_diff_文件"><code>addp-hunk-edit.diff</code> 文件</a></li>
<li><a href="#_orig_head_文件"><code>ORIG_HEAD</code> 文件</a></li>
<li><a href="#_description_文件"><code>description</code> 文件</a></li>
</ul>
</li>
<li><a href="#_git_对象">Git 对象</a>
<ul class="sectlevel2">
<li><a href="#_简介_2">简介</a></li>
<li><a href="#_blob_对象"><code>blob</code> 对象</a></li>
<li><a href="#_commit_对象"><code>commit</code> 对象</a></li>
<li><a href="#_tree_对象"><code>tree</code> 对象</a></li>
<li><a href="#_父提交">父提交</a></li>
<li><a href="#_新建目录">新建目录</a></li>
<li><a href="#_重命名文件">重命名文件</a></li>
<li><a href="#_修改大文件">修改大文件</a></li>
<li><a href="#_pack_目录"><code>pack</code> 目录</a></li>
<li><a href="#_空提交">空提交</a></li>
</ul>
</li>
<li><a href="#_资源">资源</a>
<ul class="sectlevel2">
<li><a href="#_讲座">讲座</a></li>
<li><a href="#_工具">工具</a></li>
<li><a href="#_文章">文章</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="_关于"><a class="anchor" href="#_关于"></a>关于</h2>
<div class="sectionbody">
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<img loading="lazy" src="./static/img/admonition_icons/note.png" alt="Note">
</td>
<td class="content">
译者注：本文档翻译自 <a href="https://git.harshkapadia.me" target="_blank" rel="noopener">Git Internals</a>，仅用于学习交流。
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>本 PWA 应用的内容是关于 <a href="https://harshkapadia2.github.io/git_basics/#_git" target="_blank" rel="noopener">Git</a> 的内部结构的。</p>
</div>
<div class="paragraph">
<p>本应用在 <a href="https://github.com/HarshKapadia2/git_internals" target="_blank" rel="noopener">github.com/HarshKapadia2/git_internals</a> 上开源。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<img loading="lazy" src="./static/img/admonition_icons/note.png" alt="Note">
</td>
<td class="content">
该网站的内容也以讲座的形式呈现，欢迎 <a href="https://talks.harshkapadia.me/git_internals" target="_blank" rel="noopener">观看 Git Internals 讲座</a>。
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_前置准备"><a class="anchor" href="#_前置准备"></a>前置准备</h2>
<div class="sectionbody">
<div class="paragraph">
<p>事先了解一下 Git 基础会对学习本站内容很有帮助。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>观看 <a href="https://talks.harshkapadia.me/git_basics" target="_blank" rel="noopener">Git Basics 讲座</a>.</p>
</li>
<li>
<p>浏览 <a href="https://harshkapadia2.github.io/git_basics" target="_blank" rel="noopener">git_basics</a> PWA。</p>
</li>
<li>
<p><a href="https://harshkapadia2.github.io/git_basics/#_resources" target="_blank" rel="noopener">其他资源</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_git_目录"><a class="anchor" href="#_git_目录"></a><code>.git</code> 目录</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_简介"><a class="anchor" href="#_简介"></a>简介</h3>
<div class="paragraph">
<p>在一个目录中执行 <a href="https://harshkapadia2.github.io/git_basics/#_git_init" target="_blank" rel="noopener"><code>git init</code> 命令</a> 时，Git 会在这个目录下创建一个隐藏目录 <code>.git</code>。<code>.git</code> 目录包含了 Git 可以执行其版本控制功能的项目的所有历史数据。此外，它还包含了用于配置 Git 如何处理该特定 <a href="https://harshkapadia2.github.io/git_basics/#_repository" target="_blank" rel="noopener">仓库</a> 的相关事宜的配置文件。</p>
</div>
</div>
<div class="sect2">
<h3 id="_git_目录的内容"><a class="anchor" href="#_git_目录的内容"></a><code>.git</code> 目录的内容</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">.git
├───addp-hunk-edit.diff
├───COMMIT_EDITMSG
├───config
├───description
├───FETCH_HEAD
├───HEAD
├───hooks
│   └───&lt;*.sample&gt;
├───index
├───info
│   └───exclude
├───lfs
│   ├───cache
│   │   └───locks
│   │       └───refs
│   │           └───heads
│   │               └───&lt;branch_names&gt;
│   │                   └───verifiable
│   ├───objects
│   │   └───&lt;first_2_SHA-256_characters&gt;
│   │       └───&lt;next_2_SHA-256_characters&gt;
│   │           └───&lt;entire_64_character_SHA-256_hash&gt;
│   └───tmp
├───logs
│   ├───HEAD
│   └───refs
│       ├───heads
│       │   └───&lt;branch_names&gt;
│       ├───remotes
│       │   └───&lt;remote_aliases&gt;
│       │       └───&lt;branch_names&gt;
│       └───stash
├───MERGE_HEAD
├───MERGE_MODE
├───MERGE_MSG
├───objects
│   ├───&lt;first_2_SHA-1_characters&gt;
│   │   └───&lt;remaining_38_SHA-1_characters&gt;
│   ├───info
│   │   ├───commit-graph
│   │   └───packs
│   └───pack
│       ├───multi-pack-index
│       ├───&lt;*.idx&gt;
│       ├───&lt;*.pack&gt;
│       └───&lt;*.rev&gt;
├───ORIG_HEAD
├───packed-refs
├───rebase-merge
│   ├───git-rebase-todo
│   ├───git-rebase-todo.backup
│   ├───head-name
│   ├───interactive
│   ├───no-reschedule-failed-exec
│   ├───onto
│   └───orig-head
└───refs
    ├───heads
    │   └───&lt;branch_names&gt;
    ├───remotes
    │   └───&lt;remote_aliases&gt;
    │       └───&lt;branch_names&gt;
    ├───stash
    └───tags
        └───&lt;tag_names&gt;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_index_文件"><a class="anchor" href="#_index_文件"></a><code>index</code> 文件</h3>
<div class="ulist">
<ul>
<li>
<p>该文件包含了 <a href="https://harshkapadia2.github.io/git_basics/#_added_files" target="_blank" rel="noopener">已暂存（已添加）</a> 文件的全部细节，它就是 Git 仓库的暂存区。</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<img loading="lazy" src="./static/img/admonition_icons/note.png" alt="Note">
</td>
<td class="content">
<div class="ulist">
<ul>
<li>
<p>在 Git 中，“index”，“stage” 和 “cache” 是同义词，它们之间可以互换使用。</p>
</li>
<li>
<p>不要将这个 <code>index</code> 文件和 <a href="#_pack_目录">位于 <code>.git/objects/pack</code> 中的 <code>.idx</code> 索引文件</a> 搞混了，它们之间没有关系。</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="ulist">
<ul>
<li>
<p>该文件是在第一次添加文件时创建的，以后每次执行 <a href="https://harshkapadia2.github.io/git_basics/#_git_add" target="_blank" rel="noopener"><code>git add</code> 命令</a> 时都会更新它。</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img loading="lazy" src="./static/img/index-explained.png" alt="Index file explained" width="400" height="400">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>该文件是一个二进制文件，只是使用 <code>cat .git/index</code> 查看其内容时会导致乱码. 想要查看其内容可以使用 <code>git ls-files --stage</code> [底层命令]。</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img loading="lazy" src="./static/img/git-ls-files.png" alt="'git ls-files --stage' command" width="600" height="600">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>上图中的内容解释</p>
<div class="ulist">
<ul>
<li>
<p><code>100644</code> 表示文件的模式，它是一个八进制数。</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-plaintext hljs" data-lang="plaintext">Octal: 100644
Binary: 001000 000 110100100</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>前 6 个二进制位指示对象类型。</p>
<div class="ulist">
<ul>
<li>
<p><code>001000</code> 表示普通文件。(如本例所示。)</p>
</li>
<li>
<p><code>001010</code> 表示 <a href="https://tdongsi.github.io/blog/2016/02/20/symlinks-in-git" target="_blank" rel="noopener">符号链接</a>.</p>
</li>
<li>
<p><code>001110</code> 表示 <a href="https://www.oreilly.com/library/view/version-control-with/9780596158187/ch15s04.html#:~:text=gitlink" target="_blank" rel="noopener">gitlink</a>.</p>
</li>
</ul>
</div>
</li>
<li>
<p>接下来的 3 个二进制位 (<code>000</code>) 保留。</p>
</li>
<li>
<p>最后 9 个二进制位 (<code>110100100</code>) 表示 <a href="https://harshkapadia2.github.io/cli/terminal.html#changing-permissions" target="_blank" rel="noopener">Unix 文件权限</a>。</p>
<div class="ulist">
<ul>
<li>
<p><code>644</code> 和 <code>755</code> 对于普通文件有效。</p>
</li>
<li>
<p>对于符号链接和 gitlinks 这 9 位的值都是 <code>0</code>。</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>接下来的 40 个字符的十六进制字符串表示的是文件的 <a href="https://harshkapadia2.github.io/git_basics/#_sha1" target="_blank" rel="noopener">SHA-1 哈希</a>。</p>
</li>
<li>
<p>下一个数字是暂存号/槽，它在处理合并冲突时很有用。</p>
<div class="ulist">
<ul>
<li>
<p><code>0</code> 表示正常无冲突的文件。</p>
</li>
<li>
<p><code>1</code> 表示文件的原始版本。</p>
</li>
<li>
<p><code>2</code> 表示“我们的”版本，即 HEAD 指向的版本，包括了冲突双方的更改。</p>
</li>
<li>
<p><code>3</code> 表示“他们的”版本，即被合并的版本的文件。</p>
</li>
</ul>
</div>
</li>
<li>
<p>最后的字符串是所引用文件的名称。</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<img loading="lazy" src="./static/img/admonition_icons/note.png" alt="Note">
</td>
<td class="content">
有关 <code>index</code> 文件的更多内容可参阅 <a href="#_有关暂存区_index_文件">资源</a> 一节。
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_head_文件"><a class="anchor" href="#_head_文件"></a><code>HEAD</code> 文件</h3>
<div class="ulist">
<ul>
<li>
<p>它用于引用当前分支中的最新提交。</p>
</li>
<li>
<p>HEAD 文件通常不使用这个最新 commit 的 <a href="https://harshkapadia2.github.io/git_basics/#_sha1" target="_blank" rel="noopener">SHA-1</a> 哈希，而是记录了一个在 <a href="#_refs_目录">refs 目录</a> 下的文件（以当前分支的名称命名）路径，这个文件存储了在它这个分支下最后一个 commit 的 SHA-1 哈希。</p>
</li>
<li>
<p>当 <a href="https://harshkapadia2.github.io/git_basics/#_commits_sha" target="_blank" rel="noopener">一个特定的 commit 或 tag 被检出</a> 时，该文件才会包含提交的 SHA-1 哈希。(<a href="https://harshkapadia2.github.io/git_basics/#_detached_head" target="_blank" rel="noopener">分离头（Detached HEAD）状态</a>。)</p>
</li>
<li>
<p><a href="https://harshkapadia2.github.io/git_basics/#_head" target="_blank" rel="noopener">关于 <code>HEAD</code> 文件的更多内容</a></p>
</li>
<li>
<p>Eg:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell"># in the 'main' branch
$ cat .git/HEAD
ref: refs/heads/main
$ git switch test_branch
Switched to branch 'test_branch'
$ cat .git/HEAD
ref: refs/heads/test_branch</code></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_refs_目录"><a class="anchor" href="#_refs_目录"></a><code>refs</code> 目录</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">.git
├───...
└───refs
    ├───heads
    │   └───&lt;branch_name(s)&gt;
    ├───remotes
    │   └───&lt;remote_alias(es)&gt;
    │       └───&lt;branch_name(s)&gt;
    ├───stash
    └───tags
        └───&lt;tag_name(s)&gt;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>该目录保存了对每个本地分支中最新提交的引用，并以该提交的 SHA-1 哈希形式获取远程分支。</p>
</li>
<li>
<p>它还存储了已经 [打了标签] 的 commit 的 SHA-1 哈希。</p>
</li>
<li>
<p><a href="#_head_文件"><code>HEAD</code> 文件</a> 引用了该目录（<code>refs</code>）下的 <code>heads</code> 子目录的一个文件（<a href="https://harshkapadia2.github.io/git_basics/#_new_branch_name" target="_blank" rel="noopener">以当前检出分支命名</a>）。</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<img loading="lazy" src="./static/img/admonition_icons/note.png" alt="Note">
</td>
<td class="content">
不要把 <code>.git/refs</code> 目录和 <a href="#_logs_目录"><code>.git/logs/refs</code> 目录</a> 搞混了，他们的用处不同。
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_packed_refs_文件"><a class="anchor" href="#_packed_refs_文件"></a><code>packed-refs</code> 文件</h3>
<div class="ulist">
<ul>
<li>
<p>Git 会在 <a href="#_refs_目录"><code>refs</code> 目录</a> 下的为每个分支和标签创建一个文件。</p>
</li>
<li>
<p>在拥有很多分支和标签的仓库中，便会存在很多引用（refs），其中很少会被主动使用或更改的。</p>
</li>
<li>
<p>这些引用占用了大量的存储空间，以致出现性能问题。</p>
</li>
<li>
<p><code>git pack-refs</code> 就是用来解决上面👆🏻这个问题的。它将所有的引用存储在这个名为“packed-refs”的文件中。<code>git gc</code> 命令也可以用来执行此操作。</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img loading="lazy" src="./static/img/cat-packed-refs.png" alt="Print the packed-ref file" width="600" height="600">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>执行上述命令打包后，如果某个引用在 <code>refs</code> 目录中缺失了，Git 就会在此文件中查找。</p>
</li>
<li>
<p>对已打包 ref 的分支进行后续更新（新提交、拉取或推送更改）时，会像往常一样在 <code>refs</code> 目录中创建一个带有该分支名称的新文件，但它不会将该分支在 <code>packed-refs</code> 文件中的哈希值更新为最新的哈希值。(为此必须生成一个新的 <code>packed-refs</code> 文件。）</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_logs_文件夹"><a class="anchor" href="#_logs_文件夹"></a><code>logs</code> 文件夹</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">.git
├───...
└───logs
    ├───HEAD
    └───refs
        ├───heads
        │   └───&lt;branch_name(s)&gt;
        ├───remotes
        │   └───&lt;remote_alias(es)&gt;
        │       └───&lt;branch_name(s)&gt;
        └───stash</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>该目录包含了按顺序排列的所有提交的历史记录。</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img loading="lazy" src="./static/img/cat-logs.png" alt="Print a branch&#8217;s log file" width="1000" height="1000">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>每一行内容按照从左到右的顺序分别是：父提交的 <a href="https://harshkapadia2.github.io/git_basics/<mark>_sha1" target="_blank" rel="noopener">SHA-1 哈希</a>，当前提交的 SHA-1 哈希，提交者的名字和邮箱，提交的 <a href="https://www.epochconverter.com/</mark>:~:text=What%20is%20epoch%20time" target="_blank" rel="noopener">Unix 时间戳</a>，时区，行为类型和消息。</p>
</li>
<li>
<p>本地 Git 仓库中的每个分支以及从单个或多个远程 Git 仓库（如果有的话）获取的分支都有日志。</p>
</li>
<li>
<p>进入 <code>logs</code> 目录</p>
<div class="ulist">
<ul>
<li>
<p><code>HEAD</code> 文件存储了用户执行的所有命令的信息，像分支切换、提交、变基等。</p>
</li>
<li>
<p><code>refs</code> 目录中仅包含特定于分支的操作和历史，例如提交、拉取、重置、变基等。</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<img loading="lazy" src="./static/img/admonition_icons/note.png" alt="Note">
</td>
<td class="content">
不要把 <code>.git/logs/refs</code> 目录 and the <a href="#_refs_目录"><code>.git/refs</code> 目录</a> 搞混了，他们的用处不同。
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_fetch_head_文件"><a class="anchor" href="#_fetch_head_文件"></a><code>FETCH_HEAD</code> 文件</h3>
<div class="ulist">
<ul>
<li>
<p>它包含了取回的远程分支的最新提交。</p>
</li>
<li>
<p>它对应的分支是：</p>
<div class="ulist">
<ul>
<li>
<p>上次取回时 <a href="https://harshkapadia2.github.io/git_basics/#_new_branch_name" target="_blank" rel="noopener">检出</a> 的分支。

<br />
<br />

<span class="image"><img loading="lazy" src="./static/img/cat-FETCH_HEAD-1.png" alt="The contents of the FETCH_HEAD file" width="800" height="800"></span></p>
<div class="ulist">
<ul>
<li>
<p>从上图可以看到，只有一个分支不带 <code>not-for-merge</code> 文本描述。这个奇怪的分支（本例中是 <code>main</code> 分支）就是远程取回时检出的分支。</p>
</li>
</ul>
</div>
</li>
<li>
<p>使用 <a href="https://harshkapadia2.github.io/git_basics/#_git_fetch" target="_blank" rel="noopener"><code>git fetch &lt;remote_repo_alias&gt; &lt;branch_name&gt;</code> command</a> 命令时明确指定的分支。

<br />
<br />

<span class="image"><img loading="lazy" src="./static/img/cat-FETCH_HEAD-2.png" alt="The contents of the FETCH_HEAD file" width="800" height="800"></span></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_commit_editmsg_文件"><a class="anchor" href="#_commit_editmsg_文件"></a><code>COMMIT_EDITMSG</code> 文件</h3>
<div class="ulist">
<ul>
<li>
<p>提交信息就是写入此文件中的。</p>
</li>
<li>
<p>当执行 <a href="https://harshkapadia2.github.io/git_basics/#_git_commit" target="_blank" rel="noopener"><code>git commit</code> command</a> 命令时，该文件会被编辑器打开。</p>
</li>
<li>
<p>该文件内容包含 <a href="https://harshkapadia2.github.io/git_basics/#_git_status" target="_blank" rel="noopener"><code>git status</code> command</a> 命令输出中由该字符 <code>&#35;</code> 注释掉的内容。</p>
</li>
<li>
<p>如果之前有过提交，那么这个文件将会显示上次提交的信息以及本次提交之前的 <code>git status</code> 的输出。</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_objects_目录"><a class="anchor" href="#_objects_目录"></a><code>objects</code> 目录</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">.git
├───...
└───objects
    ├───&lt;first_2_SHA-1_characters&gt;
    │   └───&lt;remaining_38_SHA-1_characters&gt;
    ├───info
    │   ├───commit-graph
    │   └───packs
    └───pack
        ├───multi-pack-index
        ├───&lt;*.idx&gt;
        └───&lt;*.pack&gt;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>.git</code> 目录下最重要的目录了。</p>
</li>
<li>
<p>它保存着仓库中所有的 <a href="#_git_对象">commit, tree and blob 对象</a> 的数据（SHA-1 哈希）。</p>
</li>
<li>
<p>为了减少访问时间，对象被放置在存储桶（目录）中，其 SHA-1 哈希值的前两个字符作为存储桶的名称，其余 38 个字符用于命名对象的文件。</p>
</li>
<li>
<p><a href="#_pack_目录">关于 <code>pack</code> 目录的更多内容</a></p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<img loading="lazy" src="./static/img/admonition_icons/note.png" alt="Note">
</td>
<td class="content">
不要将这个目录 (<code>.git/objects/info</code>) 和 <a href="#_info_目录"><code>.git/info</code> 目录</a> 搞混了，它们的用处不同。
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_info_目录"><a class="anchor" href="#_info_目录"></a><code>info</code> 目录</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">.git
├───...
└───info
    └───exclude</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>它含有一个 <code>exclude</code> 文件，其行为类似于 <a href="https://harshkapadia2.github.io/git_basics/#_gitignore_file" target="_blank" rel="noopener"><code>.gitignore</code> 文件</a>，但用于在本地忽略文件而不修改 <code>.gitignore</code>。</p>
</li>
<li>
<p><a href="https://harshkapadia2.github.io/git_basics/#_ignore_files_locally_without_modifying_gitignore" target="_blank" rel="noopener">关于 <code>exclude</code> 文件的更多内容。</a></p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<img loading="lazy" src="./static/img/admonition_icons/note.png" alt="Note">
</td>
<td class="content">
不要将这个目录 (<code>.git/info</code>) 和 <a href="#_objects_目录"><code>.git/objects/info</code> 目录</a> 搞混了，它们的用处不同。
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_config_文件"><a class="anchor" href="#_config_文件"></a><code>config</code> 文件</h3>
<div class="ulist">
<ul>
<li>
<p>这个文件包含了本地 Git 仓库的配置。</p>
</li>
<li>
<p>使用 <a href="https://harshkapadia2.github.io/git_basics/#_git_config" target="_blank" rel="noopener"><code>git config --local</code> 命令</a> 可以修改它。</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_addp_hunk_edit_diff_文件"><a class="anchor" href="#_addp_hunk_edit_diff_文件"></a><code>addp-hunk-edit.diff</code> 文件</h3>
<div class="ulist">
<ul>
<li>
<p>当在 <a href="https://harshkapadia2.github.io/git_basics/#_p_or_patch" target="_blank" rel="noopener"><code>git add --patch</code> 命令</a> 中指定了 <code>-e</code> (edit) 选项时创建该文件。</p>
</li>
<li>
<p>该文件的创建使得你可以手动编辑将要 <a href="https://harshkapadia2.github.io/git_basics/#_added_files" target="_blank" rel="noopener">暂存</a> 的文件 hunk。</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_orig_head_文件"><a class="anchor" href="#_orig_head_文件"></a><code>ORIG_HEAD</code> 文件</h3>
<div class="ulist">
<ul>
<li>
<p>它包含了一个 commit 的 SHA-1 哈希。</p>
</li>
<li>
<p>它是 HEAD 的前一个状态，但不一定是紧邻的前一个状态。</p>
</li>
<li>
<p>它是由某些具有破坏性/危险行为的命令设置的，因此它通常指向具有破坏性更改的最新提交。</p>
</li>
<li>
<p>由于 [<code>git reflog</code> 命令] 的存在，它现在不是那么有用，<code>git reflog</code> 更容易回退/重置到一个特定的 commit。</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_description_文件"><a class="anchor" href="#_description_文件"></a><code>description</code> 文件</h3>
<div class="ulist">
<ul>
<li>
<p>仓库的描述文件。</p>
</li>
<li>
<p>该文件由 <a href="https://git-scm.com/book/en/v2/Git-on-the-Server-GitWeb" target="_blank" rel="noopener">GitWeb</a> 使用，目前几乎没有人使用它，因此可以不用管。</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_git_对象"><a class="anchor" href="#_git_对象"></a>Git 对象</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_简介_2"><a class="anchor" href="#_简介_2"></a>简介</h3>
<div class="paragraph">
<p>Git 有两种数据结构, 一种是可变的（mutable） <a href="#_index_文件">index</a>，用于缓存有关工作区和下次要提交的修订的信息。另一种是不变的（immutable）、只能追加的对象数据库 (<a href="https://harshkapadia2.github.io/git_basics/#_repository" target="_blank" rel="noopener">repository</a>)，它包含四类对象：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Blob 对象</p>
</li>
<li>
<p>Commit 对象</p>
</li>
<li>
<p>Tree 对象</p>
</li>
<li>
<p>Tag 对象</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Git 使用这些对象来存储数据来以进行版本控制，通过理解这些对象可以理解 Git 的内部工作原理。</p>
</div>
<div class="paragraph">
<p>本节将通过一个示例来探讨 Git 内部工作的部分内容。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<img loading="lazy" src="./static/img/admonition_icons/note.png" alt="Note">
</td>
<td class="content">
接下来，请跟随我们的脚步随时使用 <a href="https://git-graph.harshkapadia.me" target="_blank" rel="noopener">Git Graph</a> 创建图解。
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>运行 <code>git init`</code> 在 <code>inside_git</code> 目录（根目录）中初始化一个空 <a href="https://harshkapadia2.github.io/git_basics/#_repository" target="_blank" rel="noopener">仓库</a>，Git 在根目录中会创建一个隐藏目录 <code>.git</code>。</p>
</div>
<div class="imageblock">
<div class="content">
<img loading="lazy" src="./static/img/git-init.jpg" alt="git init" width="600" height="600">
</div>
</div>
<div class="paragraph">
<p>命令 <code>du -c</code> 用于列出 <code>inside_git</code> 的子目录及其占用的磁盘大小（以 kbs 为单位）。</p>
</div>
<div class="imageblock">
<div class="content">
<img loading="lazy" src="./static/img/du-c-1.jpg" alt="du -c" width="600" height="600">
</div>
</div>
</div>
<div class="sect2">
<h3 id="_blob_对象"><a class="anchor" href="#_blob_对象"></a><code>blob</code> 对象</h3>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<img loading="lazy" src="./static/img/admonition_icons/note.png" alt="Note">
</td>
<td class="content">
Blob 对象存储了文件的内容。
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>在根目录下创建一个文件。</p>
</div>
<div class="imageblock">
<div class="content">
<img loading="lazy" src="./static/img/touch-master_file_1.jpg" alt="Create new file" width="600" height="600">
</div>
</div>
<div class="paragraph">
<p>现在，工作树（根目录）包含了 <code>.git</code> 目录和新文件 <code>master_file_1.txt</code>。</p>
</div>
<div class="imageblock">
<div class="content">
<img loading="lazy" src="./static/img/ls-a-1.jpg" alt="Master File" width="600" height="600">
</div>
</div>
<div class="paragraph">
<p>使用 <code>git add .</code> 命令将新文件添加到 <a href="https://harshkapadia2.github.io/git_basics/#_staging_staging_areaindex" target="_blank" rel="noopener">暂存区</a>，然后再次运行 <code>du -c</code>。</p>
</div>
<div class="imageblock">
<div class="content">
<img loading="lazy" src="./static/img/du-c-2.jpg" alt="Stage file" width="600" height="600">
</div>
</div>
<div class="paragraph">
<p>注意一个新目录 <code>e6</code> 被添加到了 <code>.git/objects</code> 目录下。</p>
</div>
<div class="paragraph">
<p>使用 <code>dir</code> (或 <code>ls</code>) 命令来看下 <code>.git/objects/e6</code> 目录下的文件。</p>
</div>
<div class="imageblock">
<div class="content">
<img loading="lazy" src="./static/img/dir-1.jpg" alt="Create new directory" width="600" height="600">
</div>
</div>
<div class="paragraph word-break-all">
<p>文件名 <code>9de29bb2d1d6434b8b29ae775ad8c2e48c5391</code> 38 个字符长。将其附加到文件夹名称 (<code>e6</code>) 后，就变成了 40 个字符的字符串 <code>e69de29bb2d1d6434b8b29ae775ad8c2e48c5391</code>，这是一个 <a href="https://harshkapadia2.github.io/git_basics/#_SHA-1" target="_blank" rel="noopener">SHA-1 哈希</a>。Git 使用 SHA-1 算法对文件内容（以及其他相关数据）进行哈希处理，生成 40 个字符的十六进制字符串。对于每一个 <a href="https://harshkapadia2.github.io/git_basics/#_git_add" target="_blank" rel="noopener">暂存</a>，[commit] 和 [tag] 都会生成自己唯一的 SHA-1 哈希值。（作为 40 个字符的字符串，哈希冲突非常罕见。）哈希值的前两个字符用于将哈希值归类到文件夹中，以减少访问时间。<strong>为了方便起见，Git 有时只使用对象哈希值的 4 到 8 个字符。</strong></p>
</div>
<div class="paragraph">
<p>如前所述，Git 会对文件内容以及其他细节进行散列处理，生成一个 40 个字符的 SHA-1 哈希值。为了验证这一点，我们需要在文件中添加一些内容，然后再次把文件添加到暂存区。(这将产生另一个哈希）。</p>
</div>
<div class="imageblock">
<div class="content">
<img loading="lazy" src="./static/img/add-to-master_file_1-1.jpg" alt="Add to Master file" width="600" height="600">
</div>
</div>
<div class="imageblock">
<div class="content">
<img loading="lazy" src="./static/img/edit-master_file_1-1.jpg" alt="Edit master file" width="600" height="600">
</div>
</div>
<div class="paragraph word-break-all">
<p>从上图中的最后一条命令可以推断，一个新的哈希值 <code>1a3851c172420a2198cf8ca6f2b776589d955cc5</code> 生成了。使用 cat 命令检查其内容：</p>
</div>
<div class="imageblock">
<div class="content">
<img loading="lazy" src="./static/img/cat-1.jpg" alt="Check contents" width="600" height="600">
</div>
</div>
<div class="paragraph">
<p>可以看到其输出是乱码，因为 Git 使用 <a href="https://www.zlib.net" target="_blank" rel="noopener">zlib</a> 库压缩文件内容（以及一些附加数据），然后将其存储在文件中。因此，为了弄懂这些乱码是什么意思，我们需要解压缩文件的内容。</p>
</div>
<div class="imageblock">
<div class="content">
<img loading="lazy" src="./static/img/decompress-file.png" alt="Decompress" width="600" height="600">
</div>
</div>
<div class="paragraph">
<p>可以看到，这个哈希文件的内容是 <code>blob 16\0Git is amazing!\n</code>。(<code>\0</code> 和 <code>\n</code> 不可见，下文会对其解释。)</p>
</div>
<div class="paragraph">
<p>将这段内容拆开来看：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong><code>blob</code></strong> 是文件的对象类型，它是 'Binary Large OBject' 的缩写。这种对象 (文件) 存储了文件的内容。</p>
</li>
<li>
<p><code>16</code> 是文件的尺寸（长度）。<code>Git is amazing!</code> 由 15 个字符组成, 然而 <a href="https://harshkapadia2.github.io/cli/terminal.html#:~:text=It%20can%20be%20used%20to%20add%20text%20to%20a%20file%20using%20the%20output%20redirection%20operator"><code>echo</code> 命令</a> 在文本的末尾添加了一个换行符 (<code>\n</code>)，因此其长度是 16。</p>
</li>
<li>
<p>就像在输出中看不到 <code>\n</code> 字符一样，在长度和文件内容之间有一个 NULL 字符 (<code>\0</code>)。</p>
</li>
<li>
<p><code>Git is amazing!\n</code> 是文件内容 (<code>\n</code> 不可见)。</p>
</li>
</ul>
</div>
<div class="admonitionblock note word-break-all">
<table>
<tr>
<td class="icon">
<img loading="lazy" src="./static/img/admonition_icons/note.png" alt="Note">
</td>
<td class="content">
<div class="paragraph">
<p>如果 <code>blob 16\0Git is amazing!\n</code> 是使用 SHA-1 哈希的, 那么下面也会生成相同的哈希值 (<code>1a3851c172420a2198cf8ca6f2b776589d955cc5</code>)：</p>
</div>
<div class="imageblock">
<div class="content">
<img loading="lazy" src="./static/img/sha1sum.png" alt="Generating hash for the string" width="600" height="600">
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>综上，Git 使用 <code>&lt;object_type&gt; &lt;content_length&gt;\0&lt;file_content&gt;</code> 这个字符串格式来生成文件的哈希值，然后将其压缩后存在文件中。</strong> (文件名是生成的 40 个字符哈希值的最后 38 个字符，前两个字符则用于存储它的文件夹名。)</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<img loading="lazy" src="./static/img/admonition_icons/note.png" alt="Note">
</td>
<td class="content">
Blob 对象不存储文件的差异化内容（ diff/delta），而是存储文件的完整内容。
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<img loading="lazy" src="./static/img/admonition_icons/tip.png" alt="Tip">
</td>
<td class="content">
<div class="paragraph">
<p>使用 <code>cat</code> 命令查看文件内容的过程非常繁琐，我们最好使用 Git 提供的 <code>git cat-file</code> [底层命令] 命令。</p>
</div>
<div class="paragraph">
<p>将使用的 git cat-file 命令的变体</p>
</div>
<div class="paragraph">
<p>接下来要使用 <code>git cat-file</code> 的几种形式：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>git cat-file -p &lt;hash&gt;</code> (-p = pretty print) 用于显示文件内容。</p>
</li>
<li>
<p><code>git cat-file -t &lt;hash&gt;</code> (-t = type) 用于显示文件对象类型 (blob, commit, tree 或 tag)。</p>
</li>
<li>
<p><code>git cat-file -s &lt;hash&gt;</code> (-s = size) 用于显示文件尺寸。</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_commit_对象"><a class="anchor" href="#_commit_对象"></a><code>commit</code> 对象</h3>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<img loading="lazy" src="./static/img/admonition_icons/note.png" alt="Note">
</td>
<td class="content">
Commit 对象将若干个 tree 对象链接成一个历史记录，它包含了一个 tree 对象（顶级源目录）的名称，一个时间戳，一条日志信息以及 0 个或多个父 commit 对象的名称。
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>提交 <code>master_file_1.txt</code>，然后再次运行 <code>du -c</code>。</p>
</div>
<div class="imageblock">
<div class="content">
<img loading="lazy" src="./static/img/commit-master_file_1-1.jpg" alt="Commit master file" width="600" height="600">
</div>
</div>
<div class="paragraph">
<p>从上图可以看到，有两个新目录 <code>.git/objects/1b</code> 和 <code>.git/objects/d5</code> 被创建了。而且，文件被提交后，Git 输出了这个提交的哈希值的前 7 个字符。</p>
</div>
<div class="paragraph">
<p>以这 7 个字符为参，用 <code>git cat-file -t</code> 命令检查文件类型：</p>
</div>
<div class="imageblock">
<div class="content">
<img loading="lazy" src="./static/img/cat-file-t-1.jpg" alt="Plumbing commands" width="600" height="600">
</div>
</div>
<div class="paragraph">
<p>文件类型正是 <code>commit</code>，从而可知该文件是通过一个提交生成的。</p>
</div>
<div class="paragraph">
<p>使用 <code>git cat-file -p</code> 命令输出这个 commit 对象的内容如下：</p>
</div>
<div class="imageblock">
<div class="content">
<img loading="lazy" src="./static/img/cat-file-p-1.jpg" alt="Commit" width="600" height="600">
</div>
</div>
<div class="paragraph">
<p>Commit 对象的内容解析：</p>
</div>
<div class="ulist word-break-all">
<ul>
<li>
<p><code>tree 1b2190cdc2801ec3df6505dc351dee878ac7f2fc</code> 是生成的另一个 SHA-1 哈希值（还记得提交文件时在 <code>.git/objects</code> 生成的两个目录吧），其对象类型是 <code>tree</code>，它就是当前仓库状态的 [快照（snapshot）]。</p>
</li>
<li>
<p><a href="#_父提交">父提交的 SHA-1 哈希</a>（此处不存在，下面会解释。）</p>
</li>
<li>
<p>下一行是作者的详细信息 (写代码的人)：</p>
<div class="ulist">
<ul>
<li>
<p>姓名</p>
</li>
<li>
<p>邮箱 ID</p>
</li>
<li>
<p>时间戳</p>
</li>
</ul>
</div>
</li>
<li>
<p>下一行是提交者的详细信息 (提交代码的人):</p>
<div class="ulist">
<ul>
<li>
<p>姓名</p>
</li>
<li>
<p>邮箱 ID</p>
</li>
<li>
<p>时间戳</p>
</li>
</ul>
</div>
</li>
<li>
<p>提交信息</p>
</li>
<li>
<p>提交描述 (如果提供的话，这里没有。)</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_tree_对象"><a class="anchor" href="#_tree_对象"></a><code>tree</code> 对象</h3>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<img loading="lazy" src="./static/img/admonition_icons/note.png" alt="Note">
</td>
<td class="content">
一个树对象就相当于一个（子）目录：它包含一个文件名列表，每个文件名都有一些类型位和一个 blob 或 tree 对象的名称，即这个文件、符号链接或目录的内容。这种对象描述了源目录树的一个快照。
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>让我们看一下在 commit 对象（文件）中列出的 tree 文件的内容：</p>
</div>
<div class="imageblock">
<div class="content">
<img loading="lazy" src="./static/img/cat-file-p-2.jpg" alt="Check contents" width="600" height="600">
</div>
</div>
<div class="paragraph">
<p><strong>Tree 对象类型的文件包含了本地仓库在一个快照（当前状态）中的文件和目录条目。</strong>每行的格式是相同的。</p>
</div>
<div class="paragraph">
<p>Tree 对象的内容格式如下：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>100644</code> 表示文件的模式，是一个八进制数。</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-plaintext hljs" data-lang="plaintext">Octal: 100644
Binary: 001000 000 110100100</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>前 6 个二进制位表示文件类型。</p>
<div class="ulist">
<ul>
<li>
<p><code>001000</code> 代表普通文件 (如本例所示)。</p>
</li>
<li>
<p><code>001010</code> 代表 <a href="https://tdongsi.github.io/blog/2016/02/20/symlinks-in-git" target="_blank" rel="noopener">符号链接</a>.</p>
</li>
<li>
<p><code>001110</code> 代表 a <a href="https://www.oreilly.com/library/view/version-control-with/9780596158187/ch15s04.html#:~:text=gitlink" target="_blank" rel="noopener">gitlink</a>.</p>
</li>
</ul>
</div>
</li>
<li>
<p>接下来的 3 个二进制位 (<code>000</code>) 暂未使用。</p>
</li>
<li>
<p>最后 9 个二进制位 (<code>110100100</code>) 表示 <a href="https://harshkapadia2.github.io/cli/terminal.html#changing-permissions" target="_blank" rel="noopener">Unix 文件权限</a>。</p>
<div class="ulist">
<ul>
<li>
<p><code>644</code> 和 <code>755</code> 对于普通文件有效。</p>
</li>
<li>
<p>对于符号链接和 gitlinks 这 9 位的值都是 <code>0</code>。</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
<li>
<p><code>blob</code> 标识对象类型 (<a href="#_新建目录">也可以是 <code>tree</code> 对象</a> 下文会解释。)</p>
</li>
</ul>
</div>
<div class="ulist word-break-all">
<ul>
<li>
<p><code>1a3851c172420a2198cf8ca6f2b776589d955cc5</code> 是文件 SHA-1 哈希值。</p>
</li>
<li>
<p>文件名称。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>综上，每个 commit 对象都指向一个 tree 对象，每个 tree 对象都指向若干 blob 以及/或 tree 对象，分别对应具体的文件和子目录。</strong></p>
</div>
<div class="paragraph">
<p>目前，commit、tree 和 blob 文件的连接关系如下所示：（<a href="#_head_文件"><code>HEAD</code></a> 只是一个指向最新提交的指针。）</p>
</div>
<div class="imageblock">
<div class="content">
<img loading="lazy" src="./static/img/connection-graph-1.png" alt="Connection graph" width="600" height="600">
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<img loading="lazy" src="./static/img/admonition_icons/note.png" alt="Note">
</td>
<td class="content">
<div class="ulist">
<ul>
<li>
<p>Blob <code>e69de</code> 已经被更新为 <code>1a385</code> 了，因此它没有被连接到 tree <code>1b219</code>。对于每个已添加文件来说，只有其最新的 blob 才连接到一个伴随 commit 产生的新 tree 对象上。</p>
</li>
<li>
<p>上图可以使用 <a href="https://git-graph.harshkapadia.me" target="_blank" rel="noopener">Git Graph</a> 创建。</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_父提交"><a class="anchor" href="#_父提交"></a>父提交</h3>
<div class="paragraph">
<p>再新建一个文件 (<code>master_file_2.txt</code>)，暂存并提交。</p>
</div>
<div class="imageblock">
<div class="content">
<img loading="lazy" src="./static/img/touch-master_file_2.jpg" alt="Create master file" width="600" height="600">
</div>
</div>
<div class="paragraph">
<p>看下 commit 对象类型文件的内容（使用上图中的部分哈希 <code>8282663</code>）：</p>
</div>
<div class="imageblock">
<div class="content">
<img loading="lazy" src="./static/img/cat-file-p-3.jpg" alt="Create another master file" width="600" height="600">
</div>
</div>
<div id="_dag" class="paragraph word-break-all">
<p>可以看到一个新行 <code>parent d5b8f77ce1dc1a37b29885026055c8656c3e0b65</code> 出现了。记着，这是前一个提交的哈希。<strong>Git 因此又创建了一个关系图，准确地说，应该是有向无环图。</strong>（图在下面）</p>
</div>
<div class="paragraph">
<p>而且，<a href="#_head_文件"><code>HEAD</code></a> 会自动指向这个最新的提交 <code>82826</code>，而不是父提交（前一个-<code>d5b8f</code>）。看下 <code>HEAD</code> 的指向来验证下：</p>
</div>
<div class="imageblock">
<div class="content">
<img loading="lazy" src="./static/img/head-1.jpg" alt="HEAD" width="600" height="600">
</div>
</div>
<div class="paragraph">
<p>它确实指向最新提交 (<code>82826</code>)。</p>
</div>
<div class="paragraph">
<p>现在再看下最新提交指向的 tree 对象文件的内容：</p>
</div>
<div class="imageblock">
<div class="content">
<img loading="lazy" src="./static/img/cat-file-p-4.jpg" alt="Contents of tree" width="600" height="600">
</div>
</div>
<div class="paragraph">
<p>Commit 对象，tree 对象以及 HEAD 的最新关系连接图如下所示：</p>
</div>
<div class="imageblock">
<div class="content">
<img loading="lazy" src="./static/img/connection-graph-2.png" alt="Connection graph" width="600" height="600">
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<img loading="lazy" src="./static/img/admonition_icons/note.png" alt="Note">
</td>
<td class="content">
该图可以使用 <a href="https://git-graph.harshkapadia.me" target="_blank" rel="noopener">Git Graph</a> 创建。
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_新建目录"><a class="anchor" href="#_新建目录"></a>新建目录</h3>
<div class="paragraph">
<p>在 (<code>dir_1</code>) 目录下新建一个文件 (<code>master_dir_1_file_3.txt</code>)，暂存并提交，然后看下 commit 对象类型文件的内容：</p>
</div>
<div class="imageblock">
<div class="content">
<img loading="lazy" src="./static/img/mkdir_1.jpg" alt="Create new file in directory" width="600" height="600">
</div>
</div>
<div class="paragraph">
<p>该文件内功的格式与 <a href="#_commit_对象:~:text=Commit%20对象的内容解析：">上文介绍的相同</a>。</p>
</div>
<div class="paragraph">
<p>Tree 文件（上图中的哈希 <code>f6a65</code>）的内容如下：</p>
</div>
<div class="imageblock">
<div class="content">
<img loading="lazy" src="./static/img/cat-file-p-5.jpg" alt="Contents of tree" width="600" height="600">
</div>
</div>
<div class="paragraph">
<p>令人惊讶的是，树 <code>f6a65</code> 指向另一棵树 <code>abecf</code>！新树的名称是 <code>dir_1</code>。</p>
</div>
<div class="paragraph">
<p>再看下 <code>dir_1</code> 树的内容：</p>
</div>
<div class="imageblock">
<div class="content">
<img loading="lazy" src="./static/img/cat-file-p-6.jpg" alt="Contents of directory tree" width="600" height="600">
</div>
</div>
<div class="paragraph">
<p>它指向 <code>dir_1</code> 目录下的文件 (<code>master_dir_1_file_3.txt</code>)。</p>
</div>
<div class="paragraph">
<p>来看下树 <code>f6a65</code> 是如何与其他树和 blob 建立连接的：</p>
</div>
<div class="imageblock">
<div class="content">
<img loading="lazy" src="./static/img/tree-1.png" alt="Tree" width="600" height="600">
</div>
</div>
<div class="paragraph">
<p>目前仓库的关系图是：</p>
</div>
<div class="imageblock">
<div class="content">
<img loading="lazy" src="./static/img/connection-graph-3.png" alt="Connection Graph" width="600" height="600">
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<img loading="lazy" src="./static/img/admonition_icons/note.png" alt="Note">
</td>
<td class="content">
该图可以使用 <a href="https://git-graph.harshkapadia.me" target="_blank" rel="noopener">Git Graph</a> 创建。
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_重命名文件"><a class="anchor" href="#_重命名文件"></a>重命名文件</h3>
<div class="paragraph">
<p>将 <code>master_file_1.txt</code> 重命名为 <code>the_master_file.txt</code> 来看下 Git 内部是如何处理它的。</p>
</div>
<div class="imageblock">
<div class="content">
<img loading="lazy" src="./static/img/mv-1.jpg" alt="Rename file" width="600" height="600">
</div>
</div>
<div class="imageblock">
<div class="content">
<img loading="lazy" src="./static/img/add-1.jpg" alt="Stage" width="600" height="600">
</div>
</div>
<div class="paragraph">
<p>提交文件时，Git 会识别出文件已重命名，而不是新建一个文件，如上图最后一行所示。之所以能识别到文件重命名，是因为文件的 SHA-1 哈希值没有变化（因为文件内容没有变化）。</p>
</div>
<div class="paragraph">
<p>Check the contents of the commit and tree files.</p>
</div>
<div class="imageblock">
<div class="content">
<img loading="lazy" src="./static/img/cat-file-p-7.jpg" alt="Contents of commit" width="600" height="600">
</div>
</div>
<div class="paragraph">
<p>从最后一行可以看出，哈希 <code>1a385</code> 与原始文件相同（文件名是 <code>master_file_1.txt</code>）。<strong>Git 只是在 commit 指向的树文件中记录了已经变更后的文件名称，而不是新建一个 blob 文件。</strong>这就是 Git 高效的空间管理！</p>
</div>
<div class="paragraph">
<p>当前仓库的结构如下所示：</p>
</div>
<div class="imageblock">
<div class="content">
<img loading="lazy" src="./static/img/connection-graph-4.png" alt="Connection Graph" width="800" height="800">
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<img loading="lazy" src="./static/img/admonition_icons/note.png" alt="Note">
</td>
<td class="content">
该图可以使用 <a href="https://git-graph.harshkapadia.me" target="_blank" rel="noopener">Git Graph</a> 创建。
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_修改大文件"><a class="anchor" href="#_修改大文件"></a>修改大文件</h3>
<div class="paragraph">
<p>添加图像并将其提交到 Git。图像的大小为 1.374Mb（或 1374kb），因此与其他文件（约 1 kb/文件）相比，它是一个相对较大的文件。</p>
</div>
<div class="imageblock">
<div class="content">
<img loading="lazy" src="./static/img/add-2.jpg" alt="Stage" width="600" height="600">
</div>
</div>
<div class="imageblock">
<div class="content">
<img loading="lazy" src="./static/img/cat-file-p-8.jpg" alt="Commit" width="600" height="600">
</div>
</div>
<div class="paragraph">
<p>稍微修改下图片文件的内容，然后再次暂存并提交。</p>
</div>
<div class="imageblock">
<div class="content">
<img loading="lazy" src="./static/img/add-3.jpg" alt="Stage and commit" width="600" height="600">
</div>
</div>
<div class="paragraph">
<p><code>master_image_1.png</code> 在最新树 <code>6d2d2</code> 和先前的树 <code>27666</code> 中的 SHA-1 哈希并不相同，因此 Git 为这个示例文件先后创建了两个不同的 blob 对象（<code>ca893</code> 和 <code>1f7af</code>），即便它们之间只存在细微的差别。</p>
</div>
<div class="paragraph">
<p>现在运行 <code>du -c</code>：</p>
</div>
<div class="imageblock">
<div class="content">
<img loading="lazy" src="./static/img/du-c-3.jpg" alt="Du -c" width="600" height="600">
</div>
</div>
<div class="paragraph">
<p>从上图可以看到，这两个目录 (<code>.git/objects/1f</code> 和 <code>.git/objects/ca</code>) 的大小一样 (1376 kb)。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<img loading="lazy" src="./static/img/admonition_icons/note.png" alt="Note">
</td>
<td class="content">
目录内容的大小 (1376 kb) 大于图像大小 (1374 kb)，因为 Git 将文件类型和大小（长度）添加到 blob 文件后才对其进行哈希处理。
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>那么 Git 处理大型文件的效率就低吗？当然不是。文件的内容发生了变化，产生的 SHA-1 哈希值（<code>1f7af</code>）与原来的 SHA-1 哈希值（<code>ca893</code>）不同，因此 Git 无法像处理重命名文件那样简单来处理这种变化。在本地版本库中拥有如此巨大的文件的多个副本并不是问题，但从 GitHub 等平台 <a href="https://harshkapadia2.github.io/git_basics/#_git_push" target="_blank" rel="noopener">推送</a> 和 <a href="https://harshkapadia2.github.io/git_basics/#_git_pull" target="_blank" rel="noopener">拉取</a> 则会占用大量带宽。为了避免这种情况，Git 使用了 <strong>Delta Compression</strong> 技术，它会存储旧文件与新文件的差异（diff），并将新文件作为父文件。这一点将在下面的小节中讨论。</p>
</div>
</div>
<div class="sect2">
<h3 id="_pack_目录"><a class="anchor" href="#_pack_目录"></a><code>pack</code> 目录</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">.git
├───...
└───objects
    ├───...
    └───pack
        ├───multi-pack-index
        ├───&lt;*.idx&gt;
        └───&lt;*.pack&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>每次执行 <code>clone</code>、<code>push</code> 或 <code>pull</code>，或者运行垃圾收集 (<code>git gc</code>) 时，都会执行<strong>增量压缩（Delta compression）</strong>。</p>
</div>
<div class="paragraph">
<p>增量压缩会在 <code>.git/objects/pack</code> 目录下创建两种类型的文件。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>若干 Pack (<code>.pack</code>) 文件</p>
</li>
<li>
<p>若干 Index (<code>.idx</code>) 文件</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<img loading="lazy" src="./static/img/admonition_icons/note.png" alt="Note">
</td>
<td class="content">
<div class="ulist">
<ul>
<li>
<p>一个仓库可以有多个 Packfiles。</p>
</li>
<li>
<p>每个 Packfile 对应一个 Index 文件。</p>
</li>
<li>
<p>在极端情况下也可能会创建 <a href="https://www.git-scm.com/docs/multi-pack-index" target="_blank" rel="noopener"><code>multi-pack-index</code> (MIDX) 文件</a>，但这里不考虑。</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>仓库的当前状态：</p>
</div>
<div class="imageblock">
<div class="content">
<img loading="lazy" src="./static/img/du-c-3.jpg" alt="Du -c" width="600" height="600">
</div>
</div>
<div class="paragraph">
<p>注意上图中 <code>.git/objects/pack</code> 目录的大小是 0kb。</p>
</div>
<div class="paragraph">
<p>垃圾回收（<code>git gc</code>）可以用来执行增量压缩，之后用 <code>du -c</code> 来观察变化。</p>
</div>
<div class="imageblock">
<div class="content">
<img loading="lazy" src="./static/img/du-c-4.jpg" alt="Du -c" width="600" height="600">
</div>
</div>
<div class="paragraph">
<p>请注意，上图中 <code>.git/objects/pack</code> 的大小从 0kb 变成了 1380kb，<code>.git/objects</code> 中的很多文件也消失了，只留下了 <code>.git/objects/e6</code>。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<img loading="lazy" src="./static/img/admonition_icons/note.png" alt="Note">
</td>
<td class="content">
<code>.git</code> 目录的总大小从 4220kb（见本小节的第一个 <code>du -c</code> 图像）减少到 2838kb（如上图所示），<strong>这使得本地仓库的大小减少了 32.75%</strong>！
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The contents of <code>.git/objects/pack</code></p>
</div>
<div class="imageblock">
<div class="content">
<img loading="lazy" src="./static/img/dir-2.jpg" alt="Content of directory" width="600" height="600">
</div>
</div>
<div class="paragraph">
<p>As mentioned above, two types of files (a pack <code>.pack</code> file and an index <code>.idx</code> file) are created in <code>.git/objects/pack</code>.</p>
</div>
<div class="paragraph">
<p>Check the contents of the Packfile using the plumbing command <code>git verify-pack -v path/to/pack/file/&lt;file_name&gt;.pack</code> (<code>-v</code> = verbose).</p>
</div>
<div class="imageblock">
<div class="content">
<img loading="lazy" src="./static/img/verify-pack-1.jpg" alt="Contents of files" width="600" height="600">
</div>
</div>
<div class="paragraph">
<p>From the above image, it can be understood that <strong>the Packfile contains all the Git objects</strong>. The Pack file is a file that contains all the Git Objects (along with their content) stored in it <a href="https://codewords.recurse.com/issues/three/unpacking-git-packfiles" target="_blank" rel="noopener">in a particular format</a>. All the objects stored in the Packfile are removed from the <code>.git/objects</code> directory.</p>
</div>
<div class="paragraph">
<p>From the above image, it can also be understood that the size of the newly modified image (hash <code>1f7af</code>) is very large in comparison to the original image (hash <code>ca893</code>). The blob of the original image (hash <code>ca893</code>) also has the hash of the modified image (<code>1f7af</code>) mentioned after it, indicating that its parent is the newly modified image file (hash <code>1f7af</code>). Thus <strong>Git stored the entire new file and only a diff/delta for the older file with a pointer to the newer file, rather than storing the entire file again, making it space efficient.</strong></p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<img loading="lazy" src="./static/img/admonition_icons/note.png" alt="Note">
</td>
<td class="content">
The newer file (hash <code>1f7af</code>) will usually be accessed more than the older one (hash <code>ca893</code>), so storing the entirety of the newer file and a delta/diff for the older one makes more sense than storing the entirety of the old file and a delta/diff for the new one. As the newer file will usually be accessed more, it would be inefficient to apply the delta/diff of the newer file to the entirety of the older file to generate the newer file every time. It is cheaper to apply the delta/diff of the older file to the entirety of the newer file, as the older file won&#8217;t be accessed as frequently.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<img loading="lazy" src="./static/img/admonition_icons/note.png" alt="Note">
</td>
<td class="content">
<div class="ulist">
<ul>
<li>
<p>The pack file has a graph in it just like <a href="#_dag">the Directed Acyclic Graph that the Commit, Tree and Blob objects form</a>.</p>
</li>
<li>
<p>The Index (<code>.idx</code>) file contains offsets into its corresponding Pack (<code>.pack</code>) file so that a specific object can be found quickly.</p>
</li>
<li>
<p><a href="https://codewords.recurse.com/issues/three/unpacking-git-packfiles#:~:text=each%20object%20begins.-,IDX%20files,-While%20it%E2%80%99s%20possible" target="_blank" rel="noopener">The Index (<code>.idx</code>) file has its own file structure.</a></p>
</li>
<li>
<p>Do not confuse these <code>.idx</code> Index files with <a href="#_the_index_file">the staging area <code>index</code> file</a>. They are not related.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>On running aggressive Garbage Collection (<code>git gc --aggressive</code>), Git got rid of all the files in <code>.git/objects</code> <strong>that were referenced in a tree</strong> and added them to the Pack file. The <code>.git/objects/e6</code> directory did not get removed as it was not referenced (listed) in any <a href="#_the_tree_object">Tree Object</a>.</p>
</div>
<div class="paragraph">
<p>As mentioned at the start of this sub-section, these Packfiles and Index files are created every time a clone, push or pull is executed, or if Garbage Collection (<code>git gc</code>) is run. Why is this so? Network bandwidth and clone/push/pull command execution time are the main reasons. Applying Delta compression and putting in all objects into one file makes it simpler and faster to transfer data over the Network and also saves storage space (~32% space was saved through packing in this case).</p>
</div>
<div class="paragraph">
<p>Take a look at the log of the repository.</p>
</div>
<div class="imageblock">
<div class="content">
<img loading="lazy" src="./static/img/log-1.jpg" alt="Log of repository" width="600" height="600">
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<img loading="lazy" src="./static/img/admonition_icons/note.png" alt="Note">
</td>
<td class="content">
Further reading on Packfiles can be found in the <a href="#_packfiles">Resources section</a>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_空提交"><a class="anchor" href="#_空提交"></a>空提交</h3>
<div class="paragraph">
<p><a href="https://harshkapadia2.github.io/git_basics/#_allow_empty"><code>git commit</code>^ 的 <code>--allow-empty</code> 选项</a> 允许创建不含有任何文件变更的提交记录。</p>
</div>
<div class="paragraph">
<p>由于空提交没有对任何文件进行更改，因此它们始终指向 <a href="https://harshkapadia2.github.io/git_basics/#_branches" target="_blank" rel="noopener">分支</a> 中 <strong>最新</strong> 的 <a href="#_tree_对象">树对象</a>。</p>
</div>
<div class="paragraph">
<p>为了说明这一点，请使用以下命令设置仓库：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">$ git init
$ touch file_1.txt
$ git add .
$ git commit -m "Add file_1.txt"
$ git commit --allow-empty -m "Empty commit #1"
$ git commit --allow-empty -m "Empty commit #2"

# Now run
$ git log --oneline --graph
* 208cead (HEAD -&gt; main) Empty commit #2
* 64cf914 Empty commit #1
* be0c1ec Add file_1.txt</code></pre>
</div>
</div>
<div class="paragraph">
<p>Use the <code>git cat-file -p &lt;hash&gt;</code> command as done in previous sub-sections to create the graph.</p>
</div>
<div class="paragraph">
<p>上面仓库的图解如下：</p>
</div>
<div class="imageblock">
<div class="content">
<img loading="lazy" src="./static/img/connection-graph-5.png" alt="Connection Graph" width="600" height="600">
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<img loading="lazy" src="./static/img/admonition_icons/note.png" alt="Note">
</td>
<td class="content">
<div class="ulist">
<ul>
<li>
<p>如果空提交是存储库中的第一个提交（初始提交），那么它将有自己的空树对象与之关联。在所有其他情况下，空提交将指向分支中最新的树对象。</p>
</li>
<li>
<p>该图可以使用 <a href="https://git-graph.harshkapadia.me" target="_blank" rel="noopener">Git Graph</a> 创建。</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_资源"><a class="anchor" href="#_资源"></a>资源</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_讲座"><a class="anchor" href="#_讲座"></a>讲座</h3>
<div class="ulist">
<ul>
<li>
<p><a href="https://talks.harshkapadia.me/git_internals" target="_blank" rel="noopener">Git Internals by Harsh Kapadia</a></p>
</li>
<li>
<p><a href="https://www.youtube.com/watch?v=DjOk0jnqsLk" target="_blank" rel="noopener">Git for software engineers</a></p>
</li>
<li>
<p><a href="https://www.youtube.com/watch?v=yI0BtEzdGtw" target="_blank" rel="noopener">Rules To Git By</a></p>
</li>
<li>
<p><a href="https://www.youtube.com/watch?v=P6jD966jzlk" target="_blank" rel="noopener">Fear Not The SHA!</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_工具"><a class="anchor" href="#_工具"></a>工具</h3>
<div class="ulist">
<ul>
<li>
<p><a href="https://git-graph.harshkapadia.me" target="_blank" rel="noopener">Git Graph: Visualize Commit, Tree and Blob objects</a> (by Harsh Kapadia)</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_文章"><a class="anchor" href="#_文章"></a>文章</h3>
<div class="sect3">
<h4 id="_杂项"><a class="anchor" href="#_杂项"></a>杂项</h4>
<div class="ulist">
<ul>
<li>
<p><a href="https://tom.preston-werner.com/2009/05/19/the-git-parable.html" target="_blank" rel="noopener">The Git Parable</a></p>
</li>
<li>
<p><a href="https://git.wiki.kernel.org/index.php/Git" target="_blank" rel="noopener">Git Design Overview</a></p>
</li>
<li>
<p><a href="https://matthew-brett.github.io/curious-git" target="_blank" rel="noopener">Curious Git</a></p>
</li>
<li>
<p><a href="https://github.com/pluralsight/git-internals-pdf" target="_blank" rel="noopener">Git Internals PDF</a></p>
</li>
<li>
<p><a href="https://maryrosecook.com/blog/post/git-from-the-inside-out" target="_blank" rel="noopener">Git from the Inside Out</a></p>
</li>
<li>
<p><a href="https://jwiegley.github.io/git-from-the-bottom-up" target="_blank" rel="noopener">Git from the Bottom Up</a></p>
</li>
<li>
<p><a href="https://karngyan.com/blog/git-1337-edition-1" target="_blank" rel="noopener">git - 1337 edition - I</a> and <a href="https://karngyan.com/blog/git-1337-edition-2" target="_blank" rel="noopener">git - 1337 edition - II</a></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_有关暂存区_index_文件"><a class="anchor" href="#_有关暂存区_index_文件"></a>有关暂存区 <code>index</code> 文件</h4>
<div class="ulist">
<ul>
<li>
<p><a href="https://mincong.io/2018/04/28/git-index" target="_blank" rel="noopener">Understanding the Index File.</a></p>
</li>
<li>
<p><a href="https://jwiegley.github.io/git-from-the-bottom-up/2-The-Index/1-meet-the-middle-man.html" target="_blank" rel="noopener">The Index: Meet the middle man</a></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_packfiles"><a class="anchor" href="#_packfiles"></a>Packfiles</h4>
<div class="ulist">
<ul>
<li>
<p><a href="https://codewords.recurse.com/issues/three/unpacking-git-packfiles" target="_blank" rel="noopener">Unpacking Git Packfiles</a></p>
</li>
<li>
<p><a href="https://git-scm.com/book/en/v2/Git-Internals-Packfiles" target="_blank" rel="noopener">Git Internals - Packfiles</a></p>
</li>
<li>
<p><a href="https://www.youtube.com/watch?v=cauIy20JhFs" target="_blank" rel="noopener">How To Unpack All Objects Of A Git Repository</a></p>
</li>
<li>
<p><a href="https://gist.github.com/matthewmccullough/2695758" target="_blank" rel="noopener">A Packfile example</a></p>
</li>
</ul>
</div>
<hr>
<div class="pwa-install-div hidden">
	<div id="pwa-install-text">Ready for offline use!</div>
	<button id="pwa-install-btn">Install</button>
	<button id="pwa-install-dismiss" aria-label="Dismiss PWA install prompt">
		<img loading="lazy" src="static/img/cross.svg" alt="X">
	</button>
</div>

<button class="btn hidden back-to-top-btn" aria-label="Scroll to top"><img loading="lazy" src="static/img/up-arrow.svg" alt="Top"></button>
</div>
</div>
</div>
</div>
</div>
<script src="./static/highlight/highlight.min.js"></script>
<script>
if (!hljs.initHighlighting.called) {
  hljs.initHighlighting.called = true
  ;[].slice.call(document.querySelectorAll('pre.highlight > code[data-lang]')).forEach(function (el) { hljs.highlightBlock(el) })
}
</script>
<div id="footer">
	Created using&nbsp;
	<a
		href="https://harshkapadia2.github.io/asciidoctor-jet"
		target="_blank"
		rel="noreferrer"
		><i>Asciidoctor Jet</i></a
	>.
</div>
</body>
</html>